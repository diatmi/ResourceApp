<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdn.korzh.com/metroui/v4/css/metro-all.min.css">
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
        rel="stylesheet"/>
  <title>ResourceApp</title>
</head>
<body style="background-color: #ffffffff">

<div id="main"></div>

<script charset="UTF-8" src="scripts/fuzz.js"></script>
<script>
  const JOB_PLACEMENT_SERVICES = 0
  const EDUCATION_REQUIREMENTS = 1
  const BUTTON_TRANSITION = "transition ease-in-out duration-200 h-scale-110 cursor-pointer"
  let educationReqs;
  let currentScreen = 0

  function makeMain() {
    switch (currentScreen) {
      case JOB_PLACEMENT_SERVICES:
        return makeJobPlacementServices()
      case EDUCATION_REQUIREMENTS:
        return makeEducationRequirements()
    }
  }

  function arrToLis(arr, elementToString) {
    let str = ""
    let idx = 0
    for (const thing of arr) {
      str += elementToString(thing, idx)
      idx++
    }
    return str
  }

  function makeEducationRequirements() {
    return `
      <div class="top-6 left-6 new-box-aqua h-full-margin w-full-margin monospaced">
        <div style="display:flex; flex-direction: row; justify-content: left; align-items: center;">
          <h1 style="font-size: 60px; margin-left: 10px;" class="new-text-aqua w-100 pt-2">Education Requirements</h1>
          <div style="display:flex; width:52%; flex-direction: row; justify-content: right; align-items: center; gap: 20px;">
            <button
              class="${BUTTON_TRANSITION} new-text-aqua new-box-aqua p-2 ml-3 mr-3.5 border-cyan-400 border-solid border-2"
              onclick="makeEducationRequirements_div1_button_onclick()"
            >
              See Job Placement Services
            </button>
          </div>
        </div>
        <div class="w-100 p-2 overflow-y-auto" style="height: calc(100% - 60px - 1rem)">
          <div class="pt-4"></div>
          <textarea name="jobType" id="jobTypeTextArea" cols="30" rows="2" class="transition ease-in-out duration-200 f-scale-110 f-translate-x-10 new-box-aqua border-cyan-400 border-solid border-2 resize-none"></textarea>
          <div class="pt-4"></div>
          <ol class="pl-6 new-text-aqua" id="olasdflk">
            ${arrToLis(educationReqs, (it, idx) => `<li class="list-disc ${idx === 0 ? "text-2xl" : idx === 1 ? "text-xl" : ""}">${it.title} | ${it.code} | ${it.educationNeeded} | ${it.workExperienceNeeded} | ${it.onTheJobTrainingNeeded}</li>`)}
          </ol>
        </div>
      </div>
    `
  }

  function makeJobPlacementServices() {
    return `
      <div class="top-6 left-6 new-box-aqua h-full-margin w-full-margin monospaced">
        <div style="display:flex; flex-direction: row; justify-content: left; align-items: center;">
          <h1 style="font-size: 60px; margin-left: 10px;" class="new-text-aqua w-100 pt-2">Job Placement Services</h1>
          <label for="citypicker"></label>
          <div style="display:flex; width:52%; flex-direction: row; justify-content: right; align-items: center; gap: 20px;">
            <button
              class="${BUTTON_TRANSITION} new-text-aqua new-box-aqua p-2 ml-3 border-cyan-400 border-solid border-2"
              onclick="makeJobPlacementServices_div1_button_onclick()"
            >
              See Education Requirements
            </button>
            <select class="${BUTTON_TRANSITION} new-box-aqua p-2 border-cyan-400 border-solid border-2 mr-3.5 new-text-aqua" name="city" id="citypicker">
              <option value="Fremont" selected>Fremont, California</option>
              <option value="LosAngeles">Los Angeles, California</option>
              <option value="Newark">Newark, New Jersey</option>
              <option value="NewOrleans">New Orleans, Louisiana</option>
              <option value="SanFrancisco">San Francisco, California</option>
            </select>
          </div>
        </div>
        <div class="m-4"></div>
        <div id="cards" class="mx-3 py-4 flex flex-no-wrap overflow-x-scroll scrolling-touch items-start mb-8 hide-scroll-bar h-2/3"></div>
      </div>
    `
  }

  function sanitizeURL(url) {
    if (url === undefined || url === null) return "No URL"
    url = url.substring(url.indexOf("//") + 2)
    url = url.substring(0, url.indexOf("/") === -1 ? url.length : url.indexOf("/"))
    return url
  }

  function makeCard(imgLink, title, address, rating, totalRatings, webLink, phone) {
    if (phone == null) {
      phone = "No Phone Number";
    }
    return `
    <div style="max-width: 200px;" class="${BUTTON_TRANSITION} overflow-x-hidden m-3 new-box-aqua flex-shrink-0 new-text-aqua border-cyan-400 border-solid border-2 p-2">
      <img src="${imgLink}" style="height: max-content">
      <div class="pb-3"></div>
      <div class="text-lg">${title}</div>
      <div class="pb-3"></div>
      <div>${address}</div>
      <div class="pb-3"></div>
      <div>
        <input data-stared-color="#cffafe" data-star-color="#ffffff" data-role="rating" data-value="${rating}" data-message='<span>(${totalRatings})</span>' data-static="true">
      </div>
      <div class="" style="">
        <a href="${webLink}" class="">Join! (${sanitizeURL(webLink)})<br/></a>
        <a class="">${phone}</a>
      </div>
    </div>
    `
  }

  function loadJSON(name) {
    name = "data/JobPlacementServices/" + name + ".json";
    fetch(name)
        .then(response => response.json())
        .then(data => {
          // get the div to put the cards in
          let div = document.getElementById("cards");
          // loop through the list data["local_results"]
          for (let i = 0; i < data["local_results"].length; i++) {
            // get the current item
            let item = data["local_results"][i];
            // make a card
            let card = makeCard(item["thumbnail"], item["title"], item["address"], item["rating"], item["reviews"], item["website"], item["phone"]);
            // add the card to the div
            div.innerHTML += card;
          }
        });

  }

  // name: String -> Array<Object { title, code, educationNeeded, workExperienceNeeded, onTheJobTrainingNeeded }>
  function parseEducationCSV(name) {
    let arr = []
    name = "data/EducationRequirements/" + name + ".csv"
    fetch(name)
        .then(response => response.text())
        .then(data => {
          for (const line of data.split("\n")) {
            if (line.startsWith("#")) continue
            let splits = line.split(",")
            arr.push({
              title: splits[0],
              code: splits[1],
              educationNeeded: splits[2],
              workExperienceNeeded: splits[3],
              onTheJobTrainingNeeded: splits[4]
            })
          }
        })
    return arr;
  }

  function clearCards() {
    let div = document.getElementById("cards");
    div.innerHTML = "";
  }

  function makeJobPlacementServices_div1_button_onclick() {
    currentScreen = EDUCATION_REQUIREMENTS
    document.getElementById('main').innerHTML = makeMain()
    let jobIdTextArea = document.getElementById("jobTypeTextArea")
    if (jobIdTextArea != null) {
      jobIdTextArea.addEventListener("keydown", function (ev) {
        if (ev.key === "Enter") {
          let val = document.getElementById("jobTypeTextArea").value
          educationReqs.sort((a, b) => -(fuzzball.token_set_ratio(a.title, val) - fuzzball.token_set_ratio(b.title, val)))
          document.getElementById("olasdflk").innerHTML = arrToLis(educationReqs, (it, idx) => `<li class="list-disc ${idx === 0 ? "text-2xl" : idx === 1 ? "text-xl" : ""}">${it.title} | ${it.code} | ${it.educationNeeded} | ${it.workExperienceNeeded} | ${it.onTheJobTrainingNeeded}</li>`)
          document.getElementById("jobTypeTextArea").value = ""
          ev.preventDefault()
        }
      })
    }
  }

  function makeEducationRequirements_div1_button_onclick() {
    currentScreen = JOB_PLACEMENT_SERVICES
    document.getElementById('main').innerHTML = makeMain()
    {
      let cityPicker = document.getElementById('citypicker')
      if (cityPicker != null) {
        cityPicker.onchange = function () {
          clearCards();
          loadJSON(this.value);
        }
      }
    }

    loadJSON("Fremont");
  }

  document.getElementById('main').innerHTML = makeMain()

  {
    let cityPicker = document.getElementById('citypicker')
    if (cityPicker != null) {
      cityPicker.onchange = function () {
        clearCards();
        loadJSON(this.value);
      }
    }
    educationReqs = parseEducationCSV("education")
  }

  loadJSON("Fremont");
</script>
<script src="https://cdn.korzh.com/metroui/v4/js/metro.min.js"></script>
</body>
</html>