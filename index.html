<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.korzh.com/metroui/v4/css/metro-all.min.css">
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
          rel="stylesheet"/>
    <title>ResourceApp</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
</head>
<body style="background-color: #003c8f">

<script charset="UTF-8" src="scripts/fuzz.js"></script>

<div id="main"></div>
<div id="jobreqs">
    <div style="display:flex; flex-direction: row; justify-content: left; align-items: center;">
        <h1 style="font-size: 60px; margin-left: 10px; color: black" class="new-text-aqua w-100 pt-2">Education
            Requirements</h1>
        <div style="display:flex; width:52%; flex-direction: row; justify-content: right; align-items: center; gap: 20px;">
            <button
                    class="new-text-aqua new-box-aqua p-2 ml-3 mr-3.5 border-cyan-400 btn"
                    onclick="mainScreen()">
                Go Back
            </button>
        </div>
    </div>
    <div class="w-100 p-2 overflow-y-auto" style="height: calc(100% - 60px - 1rem)">
        <div class="pt-4"></div>
        <textarea name="jobType" id="jobTypeTextArea" cols="30" rows="2"
                  style="display: block; margin-left: auto;margin-right: auto; background-image: url(assets/search.png); background-repeat: no-repeat; background-position: 7px 7px; padding-left:40px;"
                  class="btn new-input-aqua border-cyan-400 resize-none">Pilot</textarea>
        <div class="wide-card" style="background-color: #7953d2; width: fit-content">
            <p style="text-align: center; font-size: large">ðŸŽ“: degree | âŒ›: experience needed | ðŸ’ª: on the job training
                needed</p>
        </div>
        <div class="wide-card btn"
             style="padding: 10px; width: 23%; height: fit-content; background-color: aliceblue; position: absolute; margin-left: 1%; border-radius: 15px">
            <h1 style="color: black; font-size: xx-large">How this helps.</h1>
            <p>Using data from 2021, we can show you a variety of jobs, including the one you want and possibilities you
                haven't considered. We can give an estimate of the training needed for the job, the experience needed,
                and the degree you need for the job.</p>
        </div>
        <ol class="pl-6 new-text-aqua" id="olasdflk">
        </ol>
    </div>
</div>

<script>
    function arrToLis(arr, elementToString) {
        let str = ""
        let idx = 0
        for (const thing of arr) {
            str += elementToString(thing, idx)
            idx++
        }
        return str
    }

    function makeCard(imgLink, title, address, rating, totalRatings, webLink, phone) {
        if (phone == null) {
            phone = "Phone N/A";
        }
        return `
        <div class="card" style="margin: 12px; border-radius: 15px; border: none">
            <img class="card-img-top" src="${imgLink}" style="height: 180px;" onerror="this.onerror=null; this.src='assets/default.png'">
            <div class="card-body" style="height: 10rem;">
                <h5 class="card-title" style="color: white;">${title}</h5>
                <h6 class="card-subtitle mb-2 text-muted">${address}</h6>
                <div style="position: absolute; bottom: 0" >
                    <input data-stared-color="#5e92f3" data-role="rating" data-value="${rating}" data-message='<span style="color: #5e92f3;">(${totalRatings})</span>' data-static="true">
                </div>
            </div>
            <div class="card-body card-footer" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; border-color: #7953d2">
                <a href="${webLink}" class="btn btn-primary">Join</a>
                <a class="btn btn-secondary">${phone}</a>
            </div>
        </div>
        `
    }

    function loadJSON(name) {
        name = "data/Job Placement Services/" + name + ".json";
        fetch(name)
            .then(response => response.json())
            .then(data => {
                // get the div to put the cards in
                let div = document.getElementById("cards");
                // loop through the list data["local_results"]
                for (let i = 0; i < data["local_results"].length; i++) {
                    // get the current item
                    let item = data["local_results"][i];
                    // make a card
                    let card = makeCard(item["thumbnail"], item["title"], item["address"], item["rating"], item["reviews"], item["website"], item["phone"]);
                    // add the card to the div
                    div.innerHTML += card;
                }
            });
    }

    function parseCSV(name, columns) {
        let arr = []
        name = "data/EducationRequirements/" + name + ".csv"
        fetch(name)
            .then(response => response.text())
            .then(data => {
                for (const line of data.split("\n")) {
                    if (line.startsWith("#")) continue
                    let splits = [];
                    let inQuotes = false;
                    let current = "";
                    for (const char of line) {
                        if (char === '"') {
                            inQuotes = !inQuotes
                        } else if (char === "," && !inQuotes) {
                            splits.push(current)
                            current = ""
                        } else {
                            current += char
                        }
                    }
                    splits.push(current)
                    let obj = {}
                    for (let i = 0; i < columns.length; i++) {
                        obj[columns[i]] = splits[i]
                    }
                    arr.push(obj)
                }
            })
        return arr
    }

    function clearCards() {
        let div = document.getElementById("cards");
        div.innerHTML = "";
    }

    function mainScreen() {
        // get the main div
        let div = document.getElementById("main");
        let div2 = document.getElementById("jobreqs");

        div.hidden = false;
        div2.hidden = true;

        div.innerHTML = `
      <div style="display:flex; flex-direction: row; justify-content: left; align-items: start;">
          <h1 style="font-size: 60px; margin-left: 10px; color: black; width: 1000px">Job Placement Services</h1>
          <div style="display:flex; width:52%; flex-direction: row; justify-content: right; align-items: center; gap: 20px; margin-top: 20px; margin-right: 10px">
            <button class="new-text-aqua new-box-aqua p-2 ml-3 btn" onclick="loadEducationRequirements()">Job Requirements</button>
            <select class="new-box-aqua p-2 btn" name="city" id="citypicker">
              <option value="Fremont" selected>Fremont, California</option>
              <option value="LosAngeles">Los Angeles, California</option>
              <option value="Newark">Newark, New Jersey</option>
              <option value="NewOrleans">New Orleans, Louisiana</option>
              <option value="SanFrancisco">San Francisco, California</option>
           </select>
         </div>
       </div>

       <div id="cards" class="flex flex-no-wrap overflow-x-scroll scrolling-touch items-start mb-8 hide-scroll-bar" style="padding-bottom: 40px"></div>
      `;

        document.getElementById('citypicker').onchange = function () {
            console.log("changed");
            clearCards();
            loadJSON(this.value);
        }

        loadJSON("Fremont");
    }

    function loadEducationRequirements() {
        // get the main div
        let div = document.getElementById("jobreqs");
        let main = document.getElementById("main");

        main.hidden = true;
        div.hidden = false;

        let jobIdTextArea = document.getElementById("jobTypeTextArea")
        if (jobIdTextArea != null) {
            jobIdTextArea.addEventListener("keydown", function (ev) {
                if (ev.key === "Enter") {
                    let val = document.getElementById("jobTypeTextArea").value
                    educationReqs.sort((a, b) => -(fuzzball.partial_token_sort_ratio(a.title, val) - fuzzball.partial_token_sort_ratio(b.title, val)))
                    educationAttainments.sort((a, b) => -(fuzzball.partial_token_sort_ratio(a.title, val) - fuzzball.partial_token_sort_ratio(b.title, val)))
                    document.getElementById("olasdflk").innerHTML = arrToLis(educationReqs, (it, idx) => {
                        let tooltipInfo = educationAttainments[idx];
                        console.log(tooltipInfo);
                        return `
                        <div class="wide-card ${idx === 0 ? "text-2xl" : idx === 1 ? "text-xl" : ""}">
                            <!-- ${it.title} | ${it.code} | ${it.educationNeeded} | ${it.workExperienceNeeded} | ${it.onTheJobTrainingNeeded} -->
                            <div style="display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: space-between">
                                <h1 class="wide-card-h1" style="color: aliceblue">${it.title}</h1>
                                <div style="cursor: pointer" class="tooltip">&#9432;
                                    <div class="tooltiptext" style="width: 300px">
                                        <p style="color: aliceblue; font-size: medium">Less than HS diploma: ${tooltipInfo.lt_hs_dip}%</p>
                                        <p style="color: aliceblue; font-size: medium">HS diploma: ${tooltipInfo.hs_dip}%</p>
                                        <p style="color: aliceblue; font-size: medium">Some college: ${tooltipInfo.some_college}%</p>
                                        <p style="color: aliceblue; font-size: medium">Associate's degree: ${tooltipInfo.assoc_degree}%</p>
                                        <p style="color: aliceblue; font-size: medium">Bachelor's degree: ${tooltipInfo.bach_degree}%</p>
                                        <p style="color: aliceblue; font-size: medium">Master's degree: ${tooltipInfo.master_degree}%</p>
                                        <p style="color: aliceblue; font-size: medium">Professional/doctorate degree: ${tooltipInfo.doctorate_degree}%</p>
                                    </div>
                                </div>
                            </div>
                            <p class="wide-card-h1" style="color: aliceblue; font-size: medium">ðŸŽ“ ${it.educationNeeded}</p>
                            <p class="wide-card-h1" style="color: aliceblue; font-size: medium">âŒ› ${it.workExperienceNeeded}</p>
                            <p class="wide-card-h1" style="color: aliceblue; font-size: medium">ðŸ’ª ${it.onTheJobTrainingNeeded}</p>
                        </div>
        `
                    });
                    ev.preventDefault()
                }
            })
        }

        // load the initial pilot data
        let val = document.getElementById("jobTypeTextArea").value
        educationReqs.sort((a, b) => -(fuzzball.partial_token_sort_ratio(a.title, val) - fuzzball.partial_token_sort_ratio(b.title, val)))
        educationAttainments.sort((a, b) => -(fuzzball.partial_token_sort_ratio(a.title, val) - fuzzball.partial_token_sort_ratio(b.title, val)))
        document.getElementById("olasdflk").innerHTML = arrToLis(educationReqs, (it, idx) => {
            let tooltipInfo = educationAttainments[idx];
            console.log(tooltipInfo);
            return `
            <div class="wide-card ${idx === 0 ? "text-2xl" : idx === 1 ? "text-xl" : ""}">
                <!-- ${it.title} | ${it.code} | ${it.educationNeeded} | ${it.workExperienceNeeded} | ${it.onTheJobTrainingNeeded} -->
                <div style="display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: space-between">
                    <h1 class="wide-card-h1" style="color: aliceblue">${it.title}</h1>
                    <div style="cursor: pointer" class="tooltip">&#9432;
                        <div class="tooltiptext" style="width: 300px">
                            <p style="color: aliceblue; font-size: medium">Less than HS diploma: ${tooltipInfo.lt_hs_dip}%</p>
                            <p style="color: aliceblue; font-size: medium">HS diploma: ${tooltipInfo.hs_dip}%</p>
                            <p style="color: aliceblue; font-size: medium">Some college: ${tooltipInfo.some_college}%</p>
                            <p style="color: aliceblue; font-size: medium">Associate's degree: ${tooltipInfo.assoc_degree}%</p>
                            <p style="color: aliceblue; font-size: medium">Bachelor's degree: ${tooltipInfo.bach_degree}%</p>
                            <p style="color: aliceblue; font-size: medium">Master's degree: ${tooltipInfo.master_degree}%</p>
                            <p style="color: aliceblue; font-size: medium">Professional/doctorate degree: ${tooltipInfo.doctorate_degree}%</p>
                        </div>
                    </div>
                </div>
                <p class="wide-card-h1" style="color: aliceblue; font-size: medium">ðŸŽ“ ${it.educationNeeded}</p>
                <p class="wide-card-h1" style="color: aliceblue; font-size: medium">âŒ› ${it.workExperienceNeeded}</p>
                <p class="wide-card-h1" style="color: aliceblue; font-size: medium">ðŸ’ª ${it.onTheJobTrainingNeeded}</p>
            </div>
        `
        });
    }

    // main
    mainScreen();
    educationReqs = parseCSV("education", ["title", "code", "educationNeeded", "workExperienceNeeded", "onTheJobTrainingNeeded"])
    educationAttainments = parseCSV("educational_attainment", ["title", "code", "lt_hs_dip", "hs_dip", "some_college", "assoc_degree", "bach_degree", "master_degree", "doctorate_degree"])
</script>
<script src="https://cdn.korzh.com/metroui/v4/js/metro.min.js"></script>
</body>
</html>